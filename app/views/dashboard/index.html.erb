<div class="main-container">
  <div class="left-content">
    <div class="section-container">
      <h2 class="section-title"><%= @date.strftime("%-m月の家計簿") %></h2>
      <%= link_to '家計簿を記録する', new_transaction_path, class: 'btn-record' %>
      <% if @expense_by_category.present? %>
        <div class="chart-container">
          <%= pie_chart @expense_by_category, donut: true, legend: "bottom", colors: ["#FF6384", "#36A2EB", "#FFCE56", "#4BC0C0", "#9966FF", "#FF9F40"] %>
        </div>

        <%# --- カテゴリ別支出リスト --- %>
        <div class="summary-list-container">
          <h3 class="summary-title">カテゴリ別支出</h3>
          <ul class="summary-list">
            <% @expense_by_category.sort_by { |_, amount| -amount }.each do |category, amount| %>
              <li class="summary-item">
                <span class="summary-label"><%= category.presence || "カテゴリなし" %></span>
                <span class="summary-amount"><%= number_to_currency(amount, unit: '円', precision: 0, format: "%n%u") %></span>
              </li>
            <% end %>
          </ul>
        </div>

        <%# --- 直近の取引リスト --- %>
        <div class="summary-list-container">
          <h3 class="summary-title">最近の記録</h3>
          <ul class="summary-list">
            <% @recent_transactions.each do |transaction| %>
              <li class="summary-item recent-transaction">
                <span class="summary-date"><%= l(transaction.date, format: :short) %></span>
                <span class="summary-label"><%= link_to transaction.title, transaction_path(transaction) %></span>
                <span class="summary-amount expense"><%= number_to_currency(transaction.price, unit: '円', precision: 0, format: "%n%u") %></span>
              </li>
            <% end %>
          </ul>
        </div>
      <% else %>
        <div class="content-box">
          <p>今月の支出はまだありません。</p>
        </div>
      <% end %>
    </div>
  </div>

  <div class="right-content">
    <div class="section-container">
      <h2 class="section-title">スケジュール</h2>
      <%= link_to 'スケジュールを登録する', new_event_path, class: 'btn-schedule' %>
      <div class="calendar-container">
        <%# simple_calendarでカレンダーを表示します %>
        <%= month_calendar(attribute: :start_at, events: @events) do |date, events| %>
          <div class="calendar-day-number"><%= date.day %></div>

          <%# その日のイベントを1件まで表示 (ダッシュボードなのでコンパクトに) %>
          <% events.first(1).each do |event| %>
            <div class="calendar-event">
              <%= link_to event.event_title, event_path(event), class: "calendar-event-link" %>
            </div>
          <% end %>
        <% end %>
      </div>

      <%# --- 直近のイベントリスト --- %>
      <div class="upcoming-events-container">
        <%# 今日のイベント %>
        <% if @todays_events.present? %>
          <div class="upcoming-events-group">
            <h3 class="upcoming-events-title">今日の予定</h3>
            <ul class="upcoming-events-list">
              <% @todays_events.each do |event| %>
                <li class="upcoming-event-item">
                  <div class="event-item-title"><%= link_to event.event_title, event_path(event) %></div>
                  <div class="event-item-time">
                    <% if event.all_day? %>
                      <span class="all-day-badge">終日</span>
                    <% else %>
                      <%= l(event.start_at, format: :short) %>
                    <% end %>
                  </div>
                </li>
              <% end %>
            </ul>
          </div>
        <% end %>

        <%# 明日のイベント %>
        <% if @tomorrows_events.present? %>
          <div class="upcoming-events-group">
            <h3 class="upcoming-events-title">明日の予定</h3>
            <%# 今日のリストと同じ構造なので、パーシャル化も検討できます %>
            <ul class="upcoming-events-list">
              <% @tomorrows_events.each do |event| %>
                <li class="upcoming-event-item">
                  <div class="event-item-title"><%= link_to event.event_title, event_path(event) %></div>
                  <div class="event-item-time">
                    <% if event.all_day? %>
                      <span class="all-day-badge">終日</span>
                    <% else %>
                      <%= l(event.start_at, format: :short) %>
                    <% end %>
                  </div>
                </li>
              <% end %>
            </ul>
          </div>
        <% end %>

        <% if @todays_events.blank? && @tomorrows_events.blank? %>
          <p class="no-upcoming-events">今日と明日の予定はありません。</p>
        <% end %>
      </div>
    </div>
  </div>
</div>